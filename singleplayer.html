<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Single Player</title>
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>
    <div class="container">
        <!-- Single Player Setup Screen -->
        <div id="setupScreen" class="screen active">
            <div class="category-select">
                <h2 style="color: var(--text-color); margin-bottom: 1rem;">Seleziona categorie e topics</h2>

                <!-- Dataset Switcher -->
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem;">
                        <p><strong>Set di domande:</strong></p>
                        <select id="dataset-switcher"
                            style="width: 100%; padding: 0.75rem; border-radius: 0.5rem; border: 2px solid var(--border-color); background: var(--container-bg); color: var(--text-color); font-size: 1rem; cursor: pointer;">
                            <option value="questions.json">Prova Preselettiva</option>
                            <option value="questions_prova_scritta.json">Prova Scritta</option>
                        </select>
                    </label>
                </div>

                <!-- Category Cards with Expandable Topics -->
                <div id="category-cards-container">
                    <!-- Category cards will be generated dynamically based on the loaded dataset -->
                </div>

                <hr style="width:100%;text-align:left;margin-left:0; margin-top: 1rem; margin-bottom: 1.5rem;">

                <label>
                    <input type="checkbox" id="only-saved-questions"> Solo domande salvate
                </label>

                <label>
                    <p><strong>Strategia di selezione:</strong></p>
                    <select id="selection-strategy">
                        <option value="random">Casuale</option>
                        <option value="adaptive">Adattiva (focus su domande difficili)</option>
                    </select>
                </label>

                <label>
                    <p><strong>Numero di domande:</strong></p>
                    <input id="num-domande" type="number" min="1" max="10000" value="30">
                </label>

                <label>
                    <p><strong>Timer (minuti):</strong></p>
                    <input id="timer-input" type="number" min="0" max="10000" value="0">
                </label>

                <button id="start-btn" class="btn" type="button">Inizia quiz</button>
                <button id="view-stats-btn" class="btn" style="background:#17a2b8;">Visualizza Statistiche</button>
                <button id="clear-persistent" class="btn" style="background:#dc3545;" type="button">Cancella
                    cronologia</button>
                <button id="back-to-main-btn" class="btn btn-tertiary">‚Üê Men√π principale</button>
            </div>
        </div>

        <!-- Question Statistics Screen -->
        <div id="stats-screen" class="screen" style="display: none;">
            <h2>üìä Statistiche Domande</h2>
            <p style="color: var(--text-color); margin-bottom: 1rem;">Panoramica delle tue performance per domanda</p>

            <div style="margin-bottom: 1rem;">
                <label style="margin-bottom: 1rem;">
                    <p><strong>Set di domande:</strong></p>
                    <select id="stats-dataset-filter"
                        style="flex: 1; padding: 0.5rem; border-radius: 0.4rem; border: 1px solid var(--border-color); background: var(--container-bg); color: var(--text-color);">
                        <option value="questions.json">Prova Preselettiva</option>
                        <option value="questions_prova_scritta.json">Prova Scritta</option>
                    </select>
                </label>
                <label style="margin-top: 1rem;">
                    <p><strong>Filtra per categoria:</strong></p>
                    <select id="stats-category-filter"
                        style="flex: 1; padding: 0.5rem; border-radius: 0.4rem; border: 1px solid var(--border-color); background: var(--container-bg); color: var(--text-color);">
                        <option value="all">Tutte le categorie</option>
                        <!-- Categories will be populated dynamically -->
                    </select>
                </label>
                <label style="margin-top: 1rem;">
                    <p><strong>Ordina per:</strong></p>
                    <select id="stats-sort-order"
                        style="flex: 1; padding: 0.5rem; border-radius: 0.4rem; border: 1px solid var(--border-color); background: var(--container-bg); color: var(--text-color);">
                        <option value="worst">Peggiori performance</option>
                        <option value="best">Migliori performance</option>
                        <option value="most-shown">Pi√π viste</option>
                        <option value="least-shown">Meno viste</option>
                        <option value="most-likely">Pi√π probabili</option>
                        <option value="least-likely">Meno probabili</option>
                        <option value="bookmarked">Preferite</option>
                        <option value="alphabetical">altro</option>

                    </select>
                </label>
            </div>

            <div id="stats-summary"
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 0.75rem; margin-bottom: 2rem;">
            </div>

            <h3 id="dettaglio-domande-toggle"
                style="color: var(--text-color); margin-bottom: 1rem; cursor: pointer; display: flex; align-items: center; gap: 0.5rem;">
                <span id="dettaglio-domande-icon">‚ñ∂</span> Dettaglio domande viste
            </h3>
            <div id="stats-list" style="max-height: 60vh; overflow-y: auto; display: none;"></div>

            <h3 id="domande-non-viste-toggle"
                style="color: var(--text-color); margin-bottom: 1rem; cursor: pointer; display: flex; align-items: center; gap: 0.5rem;">
                <span id="domande-non-viste-icon">‚ñ∂</span> Domande non ancora viste
            </h3>
            <div id="unseen-questions-list" style="max-height: 60vh; overflow-y: auto; display: none;"></div>

            <!-- Charts section -->
            <h3 id="accuratezza-tempo-toggle"
                style="color: var(--text-color); margin-bottom: 1rem; cursor: pointer; display: flex; align-items: center; gap: 0.5rem;">
                <span id="accuratezza-tempo-icon">‚ñ∂</span> Accuratezza nel tempo
            </h3>
            <div id="accuratezza-tempo-content" style="display: none;">
                <div style="margin-bottom: 1rem; text-align: center;">
                    <label for="accuracy-filter">
                        <p><strong>Filtra per:</strong></p>
                        <select id="accuracy-filter"
                            style="flex: 1; padding: 0.5rem; border-radius: 0.4rem; border: 1px solid var(--border-color); background: var(--container-bg); color: var(--text-color);">
                            <option value="overall">Accuratezza complessiva</option>
                            <!-- Categories will be populated dynamically -->
                        </select>
                    </label>
                </div>
                <canvas id="accuracy-chart" height="250"></canvas>
            </div>

            <h3 id="risultati-categoria-toggle"
                style="color: var(--text-color); margin-top: 1rem; margin-bottom: 1rem; cursor: pointer; display: flex; align-items: center; gap: 0.5rem;">
                <span id="risultati-categoria-icon">‚ñ∂</span> Risultati per categoria
            </h3>
            <div id="risultati-categoria-content" style="display: none;">
                <canvas id="result-chart" height="300"></canvas>
            </div>

            <button id="back-from-stats-btn" class="btn btn-tertiary" style="margin-top: 1rem;">‚Üê Torna al menu</button>
        </div>

        <!-- Area quiz -->
        <div id="quiz" class="quiz-container screen">
            <div id="progress"></div>
            <div class="progress-bar-container">
                <div id="progress-bar-fill" class="progress-bar-fill"></div>
            </div>
            <div class="quiz-header">
                <button id="back-btn" class="back-btn" type="button">‚Üê Men√π principale</button>
                <div class="bookmark-btn-container">
                    <button id="bookmark-btn" class="bookmark-btn" type="button">‚≠ê</button>
                </div>
                <div class="score-timer-container">
                    <div id="score"></div>
                    <div id="timer" class="timer"></div>
                </div>
            </div>
            <div id="category"></div>
            <div id="question" class="question"></div>
            <div id="answers" class="answers"></div>
            <div class="navigation-buttons">
                <button id="prev-btn" class="btn btn-nav" type="button" disabled>‚Üê Indietro</button>
                <button id="next-btn" class="btn btn-nav" type="button" disabled>Avanti ‚Üí</button>
            </div>
        </div>

        <!-- Riepilogo -->
        <div id="summary" class="summary screen">
            <h2>Riepilogo finale</h2>
            <p id="final-score"></p>
            <div id="error-list"></div>
            <button id="restart-btn" class="btn" type="button">Torna al men√π iniziale</button>
        </div>
    </div>

    <!-- JavaScript files -->
    <script src="js/storage.js"></script>
    <script src="js/charts.js"></script>
    <script src="js/app.js"></script>
</body>

</html>